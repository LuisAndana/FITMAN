<div class="dashboard-container">
  <!-- MenÃº lateral deslizable -->
  <nav class="sidebar-menu" [class.open]="menuOpen">
    <div class="menu-close" (click)="toggleMenu()">Ã—</div>
    <ul class="menu-list">
      <li>
        <a [routerLink]="['/dashboard']" routerLinkActive="active" (click)="toggleMenu()">ğŸ“Š Dashboard</a>
      </li>
      <li>
        <a [routerLink]="['/nutriologos']" routerLinkActive="active" (click)="toggleMenu()">ğŸ‘¨â€âš•ï¸ Nutritionistas</a>
      </li>
      <li>
        <a [routerLink]="['/dietas']" routerLinkActive="active" (click)="toggleMenu()">ğŸ Mis Dietas</a>
      </li>
      <li>
        <a [routerLink]="['/contratos']" routerLinkActive="active" (click)="toggleMenu()">ğŸ“‹ Mis Contratos</a>
      </li>
      <li>
        <a [routerLink]="['/profile/cliente']" routerLinkActive="active" (click)="toggleMenu()">ğŸ‘¤ Mi Perfil</a>
      </li>
    </ul>
  </nav>

  <!-- Overlay para cerrar menÃº -->
  <div class="menu-overlay" *ngIf="menuOpen" (click)="toggleMenu()"></div>

  <main class="dashboard-main">
    <!-- SecciÃ³n de Bienvenida Hero -->
    <section class="welcome-hero">
      <div class="hero-content">
        <h2>Â¡Bienvenido de vuelta, {{ usuario?.correo?.split('@')[0] | titlecase }}! ğŸ¥—</h2>
        <p class="hero-subtitle">Gestiona tus dietas personalizadas y conecta con profesionales.</p>

        <!-- Skeleton mientras carga -->
        <div *ngIf="cargando" class="hero-stats">
          <div class="stat-box skeleton"></div>
          <div class="stat-box skeleton"></div>
          <div class="stat-box skeleton"></div>
        </div>

        <!-- Datos reales cuando cargan -->
        <div *ngIf="!cargando" class="hero-stats">
          <div class="stat-box">
            <span class="stat-icon">ğŸ‘¨â€âš•ï¸</span>
            <div>
              <p class="stat-value">{{ estadisticas.nutritionistasContratados || 0 }}</p>
              <p class="stat-label">Nutritionistas</p>
            </div>
          </div>
          <div class="stat-box">
            <span class="stat-icon">ğŸ</span>
            <div>
              <p class="stat-value">{{ estadisticas.dietasActivas || 0 }}</p>
              <p class="stat-label">Dietas Activas</p>
            </div>
          </div>
          <div class="stat-box">
            <span class="stat-icon">ğŸ“‹</span>
            <div>
              <p class="stat-value">{{ estadisticas.contratosActivos || 0 }}</p>
              <p class="stat-label">Contratos</p>
            </div>
          </div>
        </div>

        <button class="btn-primary-large" (click)="irAMisDietas()">Explorar mis Dietas â†’</button>
      </div>
    </section>

    <!-- Grid de caracterÃ­sticas principales -->
    <section class="features-grid">
      <!-- Mis Dietas Card - ahora clickeable -->
      <div class="feature-card clickable" (click)="irAMisDietas()">
        <div class="card-icon">ğŸ</div>
        <h3>Mis Dietas</h3>
        <p>Accede a tus planes nutricionales generados por IA y supervisados por nutritionistas.</p>
        <a class="card-link">Ver Dietas â†’</a>
      </div>

      <!-- Contratos Card - abre modal -->
      <div class="feature-card clickable" (click)="abrirModalContratos()">
        <div class="card-icon">ğŸ“‹</div>
        <h3>Contratos Activos</h3>
        <p>Gestiona tus acuerdos con nutritionistas y monitorea el estado de tus servicios.</p>
        <a class="card-link">Ver Contratos â†’</a>
      </div>

      <div class="feature-card">
        <div class="card-icon">ğŸ‘¨â€âš•ï¸</div>
        <h3>Encuentra Nutritionistas</h3>
        <p>Explora y contrata profesionales verificados especializados en nutriciÃ³n personalizada.</p>
        <a [routerLink]="['/nutriologos']" class="card-link">Ver Nutritionistas â†’</a>
      </div>

      <div class="feature-card">
        <div class="card-icon">ğŸ‘¤</div>
        <h3>Mi Perfil</h3>
        <p>Actualiza tu informaciÃ³n personal y preferencias de nutriciÃ³n.</p>
        <a [routerLink]="['/profile/cliente']" class="card-link">Ir al Perfil â†’</a>
      </div>
    </section>

    <!-- SecciÃ³n de Estado -->
    <section class="recent-activity">
      <h3>Estado General</h3>
      <div class="activity-list">
        <div class="activity-item" *ngIf="!cargando">
          <span class="activity-icon">âœ“</span>
          <div class="activity-content">
            <p class="activity-title">Tu perfil estÃ¡ completo</p>
            <p class="activity-time">Listo para contratar nutritionistas</p>
          </div>
        </div>
        <div class="activity-item" *ngIf="cargando">
          <span class="activity-icon">â³</span>
          <div class="activity-content">
            <p class="activity-title">Cargando informaciÃ³n...</p>
            <p class="activity-time">Un momento por favor</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- âœ… NUEVO: MODAL DE CONTRATOS -->
  <div class="modal-overlay" *ngIf="mostrarModalContratos" (click)="cerrarModalContratos()"></div>

  <div class="modal-contratos" *ngIf="mostrarModalContratos" [@slideIn]>
    <div class="modal-header">
      <h2>ğŸ“‹ Mis Contratos Activos</h2>
      <button class="modal-close" (click)="cerrarModalContratos()">Ã—</button>
    </div>

    <div class="modal-content">
      <!-- Cargando -->
      <div *ngIf="cargandoContratos" class="modal-loading">
        <p>Cargando contratos...</p>
      </div>

      <!-- Sin contratos -->
      <div *ngIf="!cargandoContratos && contratos.length === 0" class="modal-empty">
        <span class="empty-icon">ğŸ“‹</span>
        <p>No tienes contratos activos</p>
        <button class="btn-primary-small" [routerLink]="['/nutriologos']">
          Explorar Nutritionistas
        </button>
      </div>

      <!-- Lista de contratos -->
      <div *ngIf="!cargandoContratos && contratos.length > 0" class="contratos-list">
        <div class="contrato-item" *ngFor="let contrato of contratos">
          <div class="contrato-header">
            <h3>{{ contrato.otro_usuario_nombre }}</h3>
            <span class="badge" [style.backgroundColor]="getColorEstado(diasRestantes[contrato.id_contrato] || 0)">
              {{ getEstadoDiasRestantes(diasRestantes[contrato.id_contrato] || 0) }}
            </span>
          </div>

          <div class="contrato-details">
            <div class="detail-row">
              <span class="label">Monto:</span>
              <span class="value">${{ contrato.monto }} {{ contrato.moneda?.toUpperCase() }}</span>
            </div>
            <div class="detail-row">
              <span class="label">Estado:</span>
              <span class="value">{{ contrato.estado }}</span>
            </div>
            <div class="detail-row">
              <span class="label">DuraciÃ³n:</span>
              <span class="value">{{ contrato.duracion_meses }} mes(es)</span>
            </div>
            <div class="detail-row" *ngIf="contrato.fecha_fin">
              <span class="label">Vencimiento:</span>
              <span class="value">{{ contrato.fecha_fin | date: 'short' }}</span>
            </div>
          </div>

          <div class="contrato-progress">
            <div class="progress-bar" [style.width.%]="(diasRestantes[contrato.id_contrato] || 0) / (contrato.duracion_meses * 30) * 100"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="cerrarModalContratos()">Cerrar</button>
    </div>
  </div>

  <footer class="dashboard-footer">
    <p>&copy; 2024 FITMAN. GestiÃ³n de NutriciÃ³n Personalizada. Todos los derechos reservados.</p>
  </footer>
</div>