<!-- src/app/pages/nutriologo/profile-nutriologo.component.html -->

<div class="perfil-nutriologo-container">
  <!-- Header -->
  <header class="perfil-header">
    <button class="btn-back" routerLink="/nutriologos">‚Üê Volver</button>
    <h1>Perfil del Nutri√≥logo</h1>
  </header>

  <!-- Cargando -->
  <div *ngIf="cargando" class="loading">
    <div class="spinner"></div>
    <p>Cargando informaci√≥n...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error && !cargando" class="error-message">
    <p>{{ error }}</p>
  </div>

  <!-- Contenido -->
  <div *ngIf="nutriologo && !cargando" class="perfil-content">
    <!-- Tarjeta principal -->
    <section class="perfil-card">
      <div class="perfil-header-section">
        <div class="foto-container">
          <img 
            [src]="nutriologo.foto" 
            [alt]="nutriologo.nombre" 
            class="nutriologo-foto"
            onerror="this.src='assets/default-avatar.jpg'"
          />
          <div *ngIf="nutriologo.validado" class="badge-validado">
            ‚úì Validado
          </div>
        </div>

        <div class="info-principal">
          <h2>{{ nutriologo.nombre }}</h2>
          <p class="correo">{{ nutriologo.correo }}</p>

          <div class="experiencia-section">
            <div class="exp-item">
              <span class="exp-label">Experiencia:</span>
              <span class="exp-value">{{ nutriologo.experiencia_anos }} a√±os</span>
            </div>
            <div class="exp-item">
              <span class="exp-label">Tarifa:</span>
              <span class="exp-value">${{ nutriologo.precio_por_mes }}/mes</span>
            </div>
          </div>

          <button class="btn-contratar" (click)="abrirModalContrato()">
            üìù Contratar Nutri√≥logo
          </button>
        </div>
      </div>
    </section>

    <!-- Descripci√≥n -->
    <section class="seccion">
      <h3>Acerca de</h3>
      <p class="descripcion">{{ nutriologo.descripcion }}</p>
    </section>

    <!-- Especialidades -->
    <section 
      class="seccion" 
      *ngIf="nutriologo.especialidades && nutriologo.especialidades.length > 0"
    >
      <h3>Especialidades</h3>
      <div class="especialidades-grid">
        <div 
          *ngFor="let esp of nutriologo.especialidades" 
          class="especialidad-tag"
        >
          {{ esp }}
        </div>
      </div>
    </section>

    <!-- Certificaciones -->
    <section 
      class="seccion" 
      *ngIf="nutriologo.certificaciones && nutriologo.certificaciones.length > 0"
    >
      <h3>Certificaciones</h3>
      <ul class="certificaciones-list">
        <li *ngFor="let cert of nutriologo.certificaciones">{{ cert }}</li>
      </ul>
    </section>
  </div>

  <!-- Modal de Contrataci√≥n -->
  <div *ngIf="mostrarModalContrato" class="modal-overlay" (click)="cerrarModal()">
    <div class="modal-contrato" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Contratar a {{ nutriologo?.nombre }}</h2>
        <button class="close-btn" (click)="cerrarModal()" aria-label="Cerrar modal">‚úï</button>
      </div>

      <div class="modal-body">
        <!-- Informaci√≥n del nutri√≥logo -->
        <div class="info-box">
          <p><strong>Nutri√≥logo:</strong> {{ nutriologo?.nombre }}</p>
          <p><strong>Tarifa base:</strong> ${{ nutriologo?.precio_por_mes }}/mes</p>
        </div>

        <!-- Selecci√≥n de duraci√≥n -->
        <div class="form-group">
          <label for="duracion">Duraci√≥n del contrato (meses):</label>
          <div class="duracion-options">
            <button
              *ngFor="let mes of [1, 3, 6, 12]"
              [id]="'duracion-' + mes"
              [class.active]="duracionMeses === mes"
              (click)="duracionMeses = mes"
              class="duracion-btn"
              type="button"
            >
              {{ mes }} mes{{ mes !== 1 ? 'es' : '' }}
            </button>
          </div>
        </div>

        <!-- Descripci√≥n (opcional) -->
        <div class="form-group">
          <label for="descripcion">Descripci√≥n de servicios (opcional):</label>
          <textarea
            id="descripcion"
            [(ngModel)]="descripcion"
            placeholder="Ej: Quiero ayuda con dieta para p√©rdida de peso"
            class="textarea-descripcion"
            maxlength="500"
          ></textarea>
          <small style="color: var(--text-secondary);">{{ descripcion.length }}/500</small>
        </div>

        <!-- Resumen de pago -->
        <div class="resumen-pago">
          <div class="resumen-item">
            <span>Precio por mes:</span>
            <span>${{ nutriologo?.precio_por_mes }}</span>
          </div>
          <div class="resumen-item">
            <span>Duraci√≥n:</span>
            <span>{{ duracionMeses }} mes{{ duracionMeses !== 1 ? 'es' : '' }}</span>
          </div>
          <div class="resumen-item total">
            <span>Total a pagar:</span>
            <span>${{ calcularPrecioTotal() }}</span>
          </div>
        </div>

        <!-- Botones de acci√≥n -->
        <div class="modal-actions">
          <button 
            class="btn-cancelar" 
            (click)="cerrarModal()"
            [disabled]="procesandoPago"
            type="button"
          >
            Cancelar
          </button>
          <button 
            class="btn-pagar" 
            (click)="procesarPago()"
            [disabled]="procesandoPago"
            type="button"
          >
            {{ procesandoPago ? 'Procesando...' : 'Proceder al Pago' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>